<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ rname or "Mama Mia Restaurant" }} â€“ Tableau de bord</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { background-color: #f9fafb; font-family: system-ui, sans-serif; }
    .navbar { background-color: #198754; }
    .navbar-brand { color: #fff !important; font-weight: 600; }
    .logout { color: #fff; text-decoration: none; }
    .logout:hover { text-decoration: underline; }
    table { background-color: #fff; }
    th { background-color: #e9ecef; }
    td, th { vertical-align: middle !important; }
    .btn-sm { padding: 3px 8px; }
    footer { font-size: 0.8rem; color: #6c757d; text-align: center; padding: 10px 0; }
  </style>
</head>

<body>
<nav class="navbar px-4">
  <span class="navbar-brand">{{ rname or "Mama Mia Restaurant" }} â€“ Tableau de bord</span>
  <a href="{{ url_for('logout') }}" class="logout">DÃ©connexion</a>
</nav>

<main class="container mt-4">
  {% if orders %}
  <div class="table-responsive shadow-sm rounded">
    <table class="table table-bordered table-hover align-middle">
      <thead>
        <tr>
          <th>ID</th>
          <th>Date</th>
          <th>NumÃ©ro</th>
          <th>Commande</th>
          <th>Total (CDF)</th>
          <th>Adresse</th>
          <th>Status</th>
          <th>Confirmation</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for order in orders %}
        <tr>
          <form action="{{ url_for('update_status') }}" method="post">
            <input type="hidden" name="order_id" value="{{ order.id }}">
            <td>{{ order.id }}</td>
            <td>{{ order.date[:19].replace("T", " ") if order.date else "" }}</td>
            <td>{{ order.number }}</td>
            <td>{{ order["items"] or "â€”" }}</td>
            <td>{{ "{:,}".format(order.total|int) if order.total else 0 }}</td>
            <td>{{ order.address or "â€”" }}</td>

            <td>
              <select name="status" class="form-select form-select-sm">
                <option value="pending" {% if order.status == "pending" %}selected{% endif %}>En attente</option>
                <option value="ready" {% if order.status == "ready" %}selected{% endif %}>PrÃªte</option>
                <option value="delivered" {% if order.status == "delivered" %}selected{% endif %}>LivrÃ©e</option>
              </select>
            </td>

            <td>
              <input type="text" name="confirmed_by" value="{{ order.confirmed_by or '' }}" class="form-control form-control-sm" placeholder="Nom...">
            </td>

            <td>
              <button class="btn btn-success btn-sm" type="submit">ðŸ’¾ Enregistrer</button>
            </td>
          </form>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="alert alert-info text-center mt-4">Aucune commande enregistrÃ©e.</div>
  {% endif %}
</main>

<footer class="mt-4">
  Â© {{ rname or "Mama Mia" }} â€” propulsÃ© par {{ brand or "RestoBot" }}
</footer>
</body>
</html>
